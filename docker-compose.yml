services:
  backend:
    build:
      context: ./backend
    ports:
      - 8000:8000
    depends_on:
      - redis
    networks:
      - deno-scraper-network
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.backend.rule=Host(`api.techreader.com`)"
      - "traefik.http.services.backend.loadbalancer.server.port=8000"

  client:
    build:
      context: ./client
      args:
        GIT_REVISION: ${GIT_REVISION}
    ports:
      - 5000:5000
    networks:
      - deno-scraper-network
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.client.rule=Host(`www.techreader.com`)"
      - "traefik.http.services.client.loadbalancer.server.port=5000"

  redis:
    build:
      context: ./redis
    volumes:
      - ./redis-data:/data
    ports:
      - 6379:6379
    networks:
      - deno-scraper-network

networks:
  deno-scraper-network:

volumes:
  redis-data:
